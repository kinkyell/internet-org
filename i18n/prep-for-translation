#!/usr/bin/env php
<?php

$scripts = array(
	'php wrx-split.php %1 %2', // split the main export file into multiple pieces
	'transform-files %1 %2', // converts serialized content to xml
	'expand-for-languages %1 %2', // make sets of files for all languages
);

if ( ! isset( $argv[1] ) ) {
	throw new Exception( 'Missing required argument <input-directory>' );
}
$input_dir = $argv[1];

if ( ! is_dir( $input_dir ) ) {
	throw new Exception( 'Invalid input directory specified' );
}

$output_dir = 'output';
if ( isset( $argv[2] ) ) {
	$output_dir = $argv[2];
}

// create the directory if it doesn't exist
if ( ! is_dir( $output_dir ) ) {
	mkdir( $output_dir );
}

// execute our scripts - Yes, exec is bad but this is a controlled case for use
foreach ( $scripts as $script ) {
	exec( sprintf( $script, $input_dir, $output_dir ) );
}

